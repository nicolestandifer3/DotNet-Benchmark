using System;
using System.Diagnostics;
using System.Threading;
using System.Runtime.CompilerServices;
using BenchmarkDotNet;
using BenchmarkDotNet.Tasks;
using BenchmarkDotNet.Extensions;
$TargetTypeNamespace$
$TargetMethodReturnTypeNamespace$

$AdditionalLogic$

namespace BenchmarkDotNet.Autogenerated
{
    public class Program : $TargetTypeName$
    {
        private BenchmarkTask task = new BenchmarkTask($TargetBenchmarkTaskArguments$);

        public static void Main(string[] args)
        {
            try
            {
#if DNX451
                // we just start cmd.exe that starts dnx.exe that does some magic and starts this program
                // since high priority is not inherited, we need to set it up here http://stackoverflow.com/a/3798549/5852046
                Process.GetCurrentProcess().EnsureHighPriority();
                Process.GetCurrentProcess().EnsureRightProcessorAffinity();
#endif

                System.Console.WriteLine(EnvironmentInfo.GetCurrentInfo().ToFormattedString().AddPrefixMultiline("// "));
                Program instance = new Program();
                $ParamsContent$
                instance.RunBenchmark();
                System.Console.WriteLine("// Benchmark finished");
            }
            catch (Exception ex)
            {
                System.Console.WriteLine(ex);
                throw;
            }
        }

        public Program()
        {
            setupAction = $SetupMethodName$;
            idleAction = Idle;
            targetAction = $TargetMethodName$;
        }

        $TargetMethodResultHolder$
        private Action setupAction;
        private $TargetMethodDelegateType$ targetAction, idleAction;

$RunBenchmarkContent$

        private $TargetMethodReturnType$ Idle()
        {
            $IdleImplementation$
        }
    }
}
