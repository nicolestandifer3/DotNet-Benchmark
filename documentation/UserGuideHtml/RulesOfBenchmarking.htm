<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Rules of benchmarking - BenchmarkDotNet Documentation</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="css/theme.css" type="text/css" />
    <link rel="stylesheet" href="css/theme_colors.css" type="text/css" />
    <link rel="stylesheet" href="css/styles/vs.css">
    <link rel="stylesheet" href="css/font-awesome.4.5.0.min.css">
</head>
<body role="document">
    <div class="grid-for-nav">
        <nav data-toggle="nav-shift" class="nav-side stickynav">
            <div class="side-nav-search">
                <a href="index.htm"><i class="fa fa-home"></i> BenchmarkDotNet Documentation</a>
                <div role="search">
                    <form id="search-form" class="form" action="Docnet_search.htm" method="get">
                        <input type="text" name="q" placeholder="Search docs" />
                    </form>
                </div>
            </div>
            <div class="menu menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
<ul>
<li class="tocentry"><a href="index.htm">Home</a>
</li>

<li class="tocentry"><a href="GettingStarted.htm">Getting Started</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="Configuration.htm">Configuration</a></span>
</li>
<li class="tocentry"><a href="HowToRun.htm">How to run your benchmarks</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="Advancedfeatures.htm">Advanced features</a></span>
</li>
<li class="tocentry"><a href="HowItWorks.htm">How it works</a>
</li>
<li class="tocentry current"><a class="current" href="RulesOfBenchmarking.htm">Rules of benchmarking</a>
<ul class="currentrelativeroot">
<li class="tocentry"><a href="#use-the-release-build-without-an-attached-debugger">Use the Release build without an attached debugger</a></li>
<li class="tocentry"><a href="#try-different-environments">Try different environments</a></li>
<li class="tocentry"><a href="#avoid-dead-code-elimination">Avoid dead code elimination</a></li>
<li class="tocentry"><a href="#minimize-work-with-memory">Minimize work with memory</a></li>
<li class="tocentry"><a href="#power-settings-and-other-applications">Power settings and other applications</a></li>
</ul>
<li class="tocentry"><a href="faq.htm">FAQ</a>
</li>
<li class="tocentry"><a href="Team.htm">Team</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="Contributing.htm">Contributing</a></span>
</li>
<li class="tocentry"><a href="license.htm">License</a>
</li>
</ul>
				<div class="toc-footer">
					<span class="text-small">
						<hr/>
						<a href="https://github.com/FransBouma/DocNet" target="_blank">Made with <i class="fa fa-github"></i> DocNet</a>
					</span>
				</div>	
			</div>
            &nbsp;
        </nav>
        <section data-toggle="nav-shift" class="nav-content-wrap">
            <nav class="nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="nav-top" class="fa fa-bars"></i>
                <a href="index.htm">BenchmarkDotNet Documentation</a>
            </nav>
            <div class="nav-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <div class="breadcrumbs">
<ul><li><a href="index.htm">Home</a></li> / <li><a href="RulesOfBenchmarking.htm">Rules of benchmarking</a></li></ul>
					
                    </div>
                    <hr />
                </div>
                <div role="main">
                    <div class="section">
<h1 id="rules-of-benchmarking">Rules of benchmarking<a class="headerlink" href="#rules-of-benchmarking" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h1>
<h2 id="use-the-release-build-without-an-attached-debugger">Use the Release build without an attached debugger<a class="headerlink" href="#use-the-release-build-without-an-attached-debugger" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Never use the Debug build for benchmarking. <em>Never</em>. The debug version of the target method can run 10â€“100 times slower. 
The release mode means that you should have <code>&lt;Optimize&gt;true&lt;/Optimize&gt;</code> in your csproj file 
or use <a href="https://msdn.microsoft.com/en-us/library/t0hfscdc.aspx" target="_blank">/optimize</a> for <code>csc</code>. Also your never 
should use an attached debugger (e.g. Visual Studio or WinDbg) during the benchmarking. The best way is 
build our benchmark in the Release mode and run it with <code>cmd</code>.</p>
<h2 id="try-different-environments">Try different environments<a class="headerlink" href="#try-different-environments" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Please, don't extrapolate your results. Or do it very carefully.
I remind you again: the results in different environments may vary significantly. If a <code>Foo1</code> method is faster than 
a <code>Foo2</code> method for CLR4, .NET Framework 4.5, x64, RyuJIT, Windows, it means that the <code>Foo1</code> method is faster than 
the <code>Foo2</code> method for CLR4, .NET Framework 4.5, x64, RyuJIT, Windows and nothing else. And you can not say anything 
about methods performance for CLR 2 or .NET Framework 4.6 or LegacyJIT-x64 or x86 or Linux+Mono until you try it. </p>
<h2 id="avoid-dead-code-elimination">Avoid dead code elimination<a class="headerlink" href="#avoid-dead-code-elimination" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>You should also use the result of calculation. For example, if you run the following code:</p>
<pre><code class="cs">void Foo()
{
    Math.Exp(1);
}
</code></pre>

<p>then JIT can eliminate this code because the result of <code>Math.Exp</code> is not used. The better way is use it like this:</p>
<pre><code class="cs">double Foo()
{
    return Math.Exp(1);
}
</code></pre>

<h2 id="minimize-work-with-memory">Minimize work with memory<a class="headerlink" href="#minimize-work-with-memory" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>If you don't measure efficiency of access to memory, efficiency of the CPU cache, efficiency of GC, you 
shouldn't create big arrays and you shouldn't allocate big amount of memory. For example, you want to 
measure performance of <code>ConvertAll(x =&gt; 2 * x).ToList()</code>. You can write code like this:</p>
<pre><code class="cs">List&lt;int&gt; list = /* ??? */;
public List&lt;int&gt; ConvertAll()
{
    return list.ConvertAll(x =&gt; 2 * x).ToList();
}
</code></pre>

<p>In this case, you should create a small list like this:</p>
<pre><code class="cs">List&lt;int&gt; list = new List&lt;int&gt; { 1, 2, 3, 4, 5 };
</code></pre>

<p>If you create a big list (with millions of elements), then you will also measure efficiency of the CPU cache 
because you will have big amount of <a href="http://en.wikipedia.org/wiki/CPU_cache#Cache_miss" target="_blank">cache miss</a> during the calculation.  </p>
<h2 id="power-settings-and-other-applications">Power settings and other applications<a class="headerlink" href="#power-settings-and-other-applications" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<ul>
<li>Turn off all of the applications except the benchmark process and the standard OS processes. If you run benchmark and work in the Visual Studio at the same time, it can negatively affect to benchmark results.</li>
<li>If you use laptop for benchmarking, keep it plugged in and use the maximum performance mode.</li>
</ul>

                    </div>
                </div>
                <footer>
                    <hr />
                    <div role="contentinfo">
BenchmarkDotNet Documentation. &copy;2013-2016. <a href='https://github.com/PerfDotNet/BenchmarkDotNet' target='_blank'>GitHub</a> | <a href='https://www.nuget.org/packages/BenchmarkDotNet/' target='_blank'>NuGet</a>.
                    </div>
                </footer>
            </div>
        </section>
    </div>
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/modernizr-2.8.3.min.js"></script>
    <script src="js/highlight.pack.js"></script>
    <script src="js/theme.js"></script>

</body>
</html>
