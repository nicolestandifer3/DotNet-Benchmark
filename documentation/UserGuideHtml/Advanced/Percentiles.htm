<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Percentiles - BenchmarkDotNet Documentation</title>
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../css/theme_colors.css" type="text/css" />
    <link rel="stylesheet" href="../css/styles/vs.css">
    <link rel="stylesheet" href="../css/font-awesome.4.5.0.min.css">
</head>
<body role="document">
    <div class="grid-for-nav">
        <nav data-toggle="nav-shift" class="nav-side stickynav">
            <div class="side-nav-search">
                <a href="../index.htm"><i class="fa fa-home"></i> BenchmarkDotNet Documentation</a>
                <div role="search">
                    <form id="search-form" class="form" action="../Docnet_search.htm" method="get">
                        <input type="text" name="q" placeholder="Search docs" />
                    </form>
                </div>
            </div>
            <div class="menu menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
<ul>
<li class="tocentry"><a href="../index.htm">Home</a>
</li>

<li class="tocentry"><a href="../GettingStarted.htm">Getting Started</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../Configuration.htm">Configuration</a></span>
</li>
<li class="tocentry"><a href="../HowToRun.htm">How to run your benchmarks</a>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../Advancedfeatures.htm">Advanced features</a></span></li>
<li class="tocentry"><a href="../Advanced/Params.htm">Params</a>
</li>
<li class="tocentry"><a href="../Advanced/Setup.htm">Setup</a>
</li>
<li class="tocentry"><a href="../Advanced/Baseline.htm">Baseline</a>
</li>
<li class="tocentry current"><a class="current" href="../Advanced/Percentiles.htm">Percentiles</a>
<ul class="currentrelative">
<li class="tocentry"><a href="#example">Example</a></li>
</ul>

</ul>
</li>
<li class="tocentry"><a href="../HowItWorks.htm">How it works</a>
</li>
<li class="tocentry"><a href="../RulesOfBenchmarking.htm">Rules of benchmarking</a>
</li>
<li class="tocentry"><a href="../faq.htm">FAQ</a>
</li>
<li class="tocentry"><a href="../Team.htm">Team</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../Contributing.htm">Contributing</a></span>
</li>
<li class="tocentry"><a href="../license.htm">License</a>
</li>
</ul>
				<div class="toc-footer">
					<span class="text-small">
						<hr/>
						<a href="https://github.com/FransBouma/DocNet" target="_blank">Made with <i class="fa fa-github"></i> DocNet</a>
					</span>
				</div>	
			</div>
            &nbsp;
        </nav>
        <section data-toggle="nav-shift" class="nav-content-wrap">
            <nav class="nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="nav-top" class="fa fa-bars"></i>
                <a href="../index.htm">BenchmarkDotNet Documentation</a>
            </nav>
            <div class="nav-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <div class="breadcrumbs">
<ul><li><a href="../index.htm">Home</a></li> / <li><a href="../Advancedfeatures.htm">Advanced features</a></li> / <li><a href="../Advanced/Percentiles.htm">Percentiles</a></li></ul>
					
                    </div>
                    <hr />
                </div>
                <div role="main">
                    <div class="section">
<h1 id="percentiles">Percentiles<a class="headerlink" href="#percentiles" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h1>
<p>The percentile represents a higher boundary for specified percengage of a measurements.
For example, 95th percentile = 500ms means that 95% of all samples are not slower than 500ms.
This metric is not very useful in microbenchmarks, as the values from consequent runs have a very narrow distribution.
However, real-world scenarios often have so-called long tail distribution (due to IO delays, locks, memory access latency and so on), so the average execution time 
cannot be trusted.</p>
<p>The percentiles allow to include the tail of distribution into the comparison. However, it requires some preparations steps.
At first, you should have enough runs to count percentiles from. The <code>TargetCount</code> in the config should be set to 10-20 runs at least.  </p>
<p>Second, the count of iterations for each run should not be very high, or the peak timings will be averaged.
The <code>IterationTime = 25</code> works fine for most cases; for long-running benchmarks the <code>Mode = Mode.SingleRun</code> will be the best choice. 
However, feel free to experiment with the config values.</p>
<p>Third, if you want to be sure that measurements are repeatable, set the <code>LaunchCount</code> to 3 or higher.</p>
<p>And last, don't forget to include the columns into the config. They are not included by default (as said above, these are not too useful for most of the benchmarks).
There're predefined <code>StatisticColumn.P0</code>..<code>StatisticColumn.P100</code> for absolute timing percentiles and <code>BaselineDiffColumn.Scaled50</code>..<code>BaselineDiffColumn.Scaled95</code> 
for relative percentiles.</p>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Run the IntroPercentiles sample. It contains three benchmark methods.</p>
<ul>
<li>First delays for 20 ms constantly.</li>
<li>The second has random delays for 10..30 ms.</li>
<li>And the third delays for 10ms 85 times of 100 and delays for 40ms 15 times of 100.</li>
</ul>
<p>Here's the output from the benchmark (some columns removed for brevity):</p>
<table class="table table-bordered-all table-responsive">
<thead>
<tr>
	<th>Method</th>
	<th>Median</th>
	<th>StdDev</th>
	<th>Scaled</th>
	<th>P0</th>
	<th>P50</th>
	<th>P80</th>
	<th>P85</th>
	<th>P95</th>
	<th>P100</th>
	<th>ScaledP50</th>
	<th>ScaledP85</th>
	<th>ScaledP95</th>
</tr>
</thead>
<tbody>
<tr>
	<td>ConstantDelays</td>
	<td>20.3813 ms</td>
	<td>0.2051 ms</td>
	<td>1.00</td>
	<td>20.0272 ms</td>
	<td>20.3813 ms</td>
	<td>20.4895 ms</td>
	<td>20.4954 ms</td>
	<td>20.5869 ms</td>
	<td>21.1471 ms</td>
	<td>1.00</td>
	<td>1.00</td>
	<td>1.00</td>
</tr>
<tr>
	<td>RandomDelays</td>
	<td>19.8055 ms</td>
	<td>5.7556 ms</td>
	<td>0.97</td>
	<td>10.0793 ms</td>
	<td>19.8055 ms</td>
	<td>25.4173 ms</td>
	<td>26.5187 ms</td>
	<td>29.0313 ms</td>
	<td>29.4550 ms</td>
	<td>0.97</td>
	<td>1.29</td>
	<td>1.41</td>
</tr>
<tr>
	<td>RareDelays</td>
	<td>10.3385 ms</td>
	<td>11.4828 ms</td>
	<td>0.51</td>
	<td>10.0157 ms</td>
	<td>10.3385 ms</td>
	<td>10.5211 ms</td>
	<td>40.0560 ms</td>
	<td>40.3992 ms</td>
	<td>40.4674 ms</td>
	<td>0.51</td>
	<td>1.95</td>
	<td>1.96</td>
</tr>
</tbody>
</table>
<p>Note that the 'Scaled' column kinda lies to you. 
The &quot;almost same&quot; RandomDelays method is actually not so performant and the seems-to-be-fastest RareDelays method is 2 times slower 15 times of 100.</p>
<p>Also, it's very easy to screw the results with incorrect setup. For example, the same code being run with</p>
<pre><code class="cs">new Job
{
    TargetCount = 5,
    IterationTime = 500
}
</code></pre>

<p>completely hides the peak values:</p>
<table class="table table-bordered-all table-responsive">
<thead>
<tr>
	<th>Method</th>
	<th>Median</th>
	<th>StdDev</th>
	<th>Scaled</th>
	<th>P0</th>
	<th>P50</th>
	<th>P80</th>
	<th>P85</th>
	<th>P95</th>
	<th>P100</th>
	<th>ScaledP50</th>
	<th>ScaledP85</th>
	<th>ScaledP95</th>
</tr>
</thead>
<tbody>
<tr>
	<td>ConstantDelays</td>
	<td>20.2692 ms</td>
	<td>0.0308 ms</td>
	<td>1.00</td>
	<td>20.1986 ms</td>
	<td>20.2692 ms</td>
	<td>20.2843 ms</td>
	<td>20.2968 ms</td>
	<td>20.3097 ms</td>
	<td>20.3122 ms</td>
	<td>1.00</td>
	<td>1.00</td>
	<td>1.00</td>
</tr>
<tr>
	<td>RandomDelays</td>
	<td>18.9965 ms</td>
	<td>0.8601 ms</td>
	<td>0.94</td>
	<td>18.1339 ms</td>
	<td>18.9965 ms</td>
	<td>19.8126 ms</td>
	<td>19.8278 ms</td>
	<td>20.4485 ms</td>
	<td>20.9466 ms</td>
	<td>0.94</td>
	<td>0.98</td>
	<td>1.01</td>
</tr>
<tr>
	<td>RareDelays</td>
	<td>14.0912 ms</td>
	<td>2.8619 ms</td>
	<td>0.70</td>
	<td>10.2606 ms</td>
	<td>14.0912 ms</td>
	<td>15.7653 ms</td>
	<td>17.3862 ms</td>
	<td>18.6728 ms</td>
	<td>18.6940 ms</td>
	<td>0.70</td>
	<td>0.86</td>
	<td>0.92</td>
</tr>
</tbody>
</table>

                    </div>
                </div>
                <footer>
                    <hr />
                    <div role="contentinfo">
BenchmarkDotNet Documentation. &copy;2013-2016. <a href='https://github.com/PerfDotNet/BenchmarkDotNet' target='_blank'>GitHub</a> | <a href='https://www.nuget.org/packages/BenchmarkDotNet/' target='_blank'>NuGet</a>.
                    </div>
                </footer>
            </div>
        </section>
    </div>
    <script src="../js/jquery-2.1.1.min.js"></script>
    <script src="../js/modernizr-2.8.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/theme.js"></script>

</body>
</html>
